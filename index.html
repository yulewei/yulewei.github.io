<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/favicon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon.png">
  <link rel="mask-icon" href="/favicon.png" color="#222">
  <meta name="baidu-site-verification" content="qxFtDn0ziX">
  <meta name="sogou_site_verification" content="Wj1N74IImQ" /> 

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Consolas:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"nullwy.me","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="nullwy&#39;s blog">
<meta property="og:url" content="https://nullwy.me/index.html">
<meta property="og:site_name" content="nullwy&#39;s blog">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="nullwy">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://nullwy.me/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>nullwy's blog</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-Y4LE29KVMN"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-Y4LE29KVMN');
      }
    </script>


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?928b3d50428cc362a2d2ed846517583e";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><link rel="alternate" href="/atom.xml" title="nullwy's blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">nullwy's blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://nullwy.me/2024/02/java-synchronization-implementation/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://static.nullwy.me/avatar.png">
      <meta itemprop="name" content="nullwy">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="nullwy's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/02/java-synchronization-implementation/" class="post-title-link" itemprop="url">Java 线程同步实现原理深度解析</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-02-10 15:58:00" itemprop="dateCreated datePublished" datetime="2024-02-10T15:58:00+08:00">2024-02-10</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    <i class="far fa-comment"></i>
    <a title="disqus" href="/2024/02/java-synchronization-implementation/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2024/02/java-synchronization-implementation/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>31k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>28 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>本文内容主要是，以官方文档资料和 Java 8 的 JDK 和 HotSpot 源码为依据，对 Java 的基于 <code>synchronized</code> 和 <code>ReentrantLock</code> 线程同步的底层实现原理进行总结梳理和深度解析。同时，也在广度上对线程同步相关的基础概念做总结概括。</p>
<h1 id="基础概念">基础概念</h1>
<p>在并发编程模型中，需要处理的两个最关键的问题就是<strong>通信</strong>（communication）和<strong>同步</strong>（synchronization）<sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup>。通信指线程可用于获得其他线程产生的信息的各种机制。通信机制通常都基于<strong>共享内存</strong>（<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Shared_memory">shared memory</a>）或<strong>消息传递</strong>（<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Message_passing">message passing</a>）。在共享内存的编程模型中，某些或全部程序变量可以由多个线程访问。如果一对线程之间需要通信，只要一个线程将值写入某个变量，另一线程来读它即可。在消息传递编程模型中，不同线程没有公共的状态。当一对线程之间需要通信时，其中的一个必须执行一次明确的 send 操作，将数据传送给另一个线程。</p>
<p><strong>同步</strong><sup class="footnote-ref"><a href="#fn1" id="fnref1:1">[1:1]</a></sup>是控制不同线程之间操作发生的相对顺序的各种机制，用以排除导致不正确结果的交错。消息传递模型中的同步通常是隐式的，消息的发送必须在接收之前。如果某个线程企图接收一个尚未发送的消息，那么它就必须等到发送方赶上来。在共享内存编程模型中，同步通常不是隐式的，除非我们做了某些特殊的事情，否则“接收方”就可能在某个变量被“发送方”修改之前读到其中的“老”值。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2024/02/java-synchronization-implementation/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://nullwy.me/2024/01/rocketmq-kafka-sharding-replication/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://static.nullwy.me/avatar.png">
      <meta itemprop="name" content="nullwy">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="nullwy's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/01/rocketmq-kafka-sharding-replication/" class="post-title-link" itemprop="url">RocketMQ 和 Kafka 的数据分片和复制策略</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-01-18 20:36:00" itemprop="dateCreated datePublished" datetime="2024-01-18T20:36:00+08:00">2024-01-18</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%9E%B6%E6%9E%84/" itemprop="url" rel="index"><span itemprop="name">架构</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    <i class="far fa-comment"></i>
    <a title="disqus" href="/2024/01/rocketmq-kafka-sharding-replication/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2024/01/rocketmq-kafka-sharding-replication/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>10k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>9 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>为了提升系统的<strong>可扩展性</strong>（scalability），分布式数据库或分布式存储系统通常支持数据<strong>分区</strong>（partitioning）或<strong>分片</strong>（sharding），即将完整的数据拆分存放在多个服务器节点上，拆分后的部分数据称为“partition”或“<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Shard_%28database_architecture%29">shard</a>”。数据被拆分后多个服务器节点能分摊负载压力，从而提升系统性能。“分区”和分片”，这两个术语，在很多情况下不区分，可以混用。如果严格区分的话，<strong>分片</strong>拆分的数据分布在多个服务器节点上，而<strong>分区</strong>拆分的数据在单个服务器节点。另外，<strong>复制</strong>（<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Replication_%28computing%29">replication</a>）也典型的分布式技术，多个数据副本能实现读请求的负载均衡，提升系统性能。同时复制也提供了冗余容错的能力，提升系统的<strong>可用性</strong>（availability）。本文关注消息中间件的消息存储系统，解析并对比 RocketMQ 和 Kafka 的消息数据的分片和复制的具体实现策略。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2024/01/rocketmq-kafka-sharding-replication/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://nullwy.me/2024/01/distributed-storage-system-sharding-replication/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://static.nullwy.me/avatar.png">
      <meta itemprop="name" content="nullwy">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="nullwy's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/01/distributed-storage-system-sharding-replication/" class="post-title-link" itemprop="url">分布式存储系统的分片和复制策略案例解析</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-01-18 20:36:00" itemprop="dateCreated datePublished" datetime="2024-01-18T20:36:00+08:00">2024-01-18</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%9E%B6%E6%9E%84/" itemprop="url" rel="index"><span itemprop="name">架构</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    <i class="far fa-comment"></i>
    <a title="disqus" href="/2024/01/distributed-storage-system-sharding-replication/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2024/01/distributed-storage-system-sharding-replication/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>13k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>12 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <div class="pdfobject-container" data-target="media/middleware.pdf" data-height="500px"></div>
<h1 id="MySQL（2001）">MySQL（2001）</h1>
<p><strong>MySQL 的数据分片和复制的历史演进时间线</strong>：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://web.archive.org/web/20010126203700/http://www.mysql.com/news/article-54.html">2001.01</a>，MySQL 3.23 GA 版发布，开始提供复制（replication）功能，参见官方文档 <a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/replication.html">doc</a>。</li>
<li><a target="_blank" rel="noopener" href="https://www.infoq.com/news/2007/10/mysqlproxyrwsplitting/">2007.06</a>，MySQL 官方发布 <a target="_blank" rel="noopener" href="https://web.archive.org/web/20160413134318/http://dev.mysql.com/doc/mysql-proxy/en/mysql-proxy-introduction.html">MySQL Proxy</a>，MySQL 代理服务器，支持内嵌 Lua 脚本，通过 Lua 脚本能实现负载均衡、主从自动故障切换、读写分离等。不过 MySQL Proxy 一直处于 Alpha 版状态，不推荐生产环境使用。2015 年发布 MySQL Router 后，MySQL Proxy 被废弃。</li>
<li>2008.11，MySQL 5.1 GA 版发布，开始提供分区（partition）的功能，参见官方文档 <a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/partitioning.html">doc</a>。</li>
<li>2014.05，<a target="_blank" rel="noopener" href="https://web.archive.org/web/20150806192507/http://dev.mysql.com/doc/mysql-fabric/1.6/en/">MySQL Fabric</a> GA 版发布，官方的高可用（HA）和数据分片（sharding）方案，基于客户端库（Fabric-aware Connector）实现分片路由，不支持跨分片查询。
<ul>
<li>2017.07，MySQL Fabric 被官方废弃，推荐迁移到 MySQL InnoDB Cluster。</li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://finance.yahoo.com/news/news/oracle-announces-general-availability-mysql-140000831.html">2015.10</a>，MySQL 5.7 GA 版发布，代理服务器 <a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/mysql-router/8.0/en/">MySQL Router</a> 也开始 GA 版可用，是 MySQL Proxy 的替代方案。同时，MySQL Group Replication 早期版可访问。</li>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/blog-archive/mysql-group-replication-its-in-5-7-17-ga/">2016.12</a>，MySQL 5.7.17 发布，MySQL 组复制（<a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/group-replication.html">Group Replication</a>）特性开始 GA 版可用。MySQL 组复制基于 Paxos 协议实现节点间的数据复制，实现主从自动故障切换，最多能容忍不超过半数的节点故障。</li>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/blog-archive/mysql-innodb-cluster-ga/">2017.04</a>，MySQL 官方的 <a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/mysql-innodb-cluster-introduction.html">InnoDB Cluster</a> 开始 GA 版可用，三个核心组件 Group Replication、MySQL Shell、MySQL Router。</li>
</ul>
<p><strong>MySQL 官方版的数据分片和复制策略</strong><sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup><sup class="footnote-ref"><a href="#fn2" id="fnref2">[2]</a></sup>：</p>
<ul>
<li><strong>分片策略</strong>：
<ul>
<li><strong>分片术语命名</strong>：分区（<a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/partitioning.html">partition</a>）
<ul>
<li>将单个表数据拆分为多个表分区中</li>
</ul>
</li>
<li><strong>键-分片的分配关系</strong>：同时支持按 Range 和 Hash 拆分，在定义表时手动指定分区规则</li>
<li><strong>分片-机器的分配关系</strong>：拆分后的多个分区分布同一个服务器节点上</li>
<li><strong>分片再均衡</strong>：无</li>
</ul>
</li>
<li><strong>复制策略</strong>：主从（Master/Slave）模式，服务器节点区分主从（Master/Slave）两种角色，由一个 Master 节点和零到多个 Slave 节点组成复制组，Master 节点负责处理写和读请求，Slave 节点可用于读，复制组内的节点数据保持同步。虽然理论上从库允许直接修改，但修改可能会导致主从库数据不一致，不推荐对从库做写操作。
<ul>
<li><strong>复制单位</strong>：以服务器节点（机器）为单位</li>
<li><strong>复制系数</strong>：即复制组内的服务器节点数量</li>
<li><strong>副本更新传播策略</strong>：支持异步复制（asynchronous replication）（默认）、半同步复制（<a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/replication-semisync.html">semisynchronous replication</a>）和组复制（<a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/group-replication.html">group replication</a>）三种模式
<ul>
<li><strong>组复制</strong>（group replication），MySQL 5.7 开始支持，基于 <strong>Paxos 协议</strong>实现，是强一致性的复制，InnoDB Cluster 基于组复制实现。采用组复制的事务要求过半数以上节点同意后才提交，最多能容忍不超过半数的节点故障。</li>
<li><strong>全同步复制</strong>（fully synchronous replication），指的是强一致性的全同步复制，<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/MySQL_Cluster">MySQL NDB Cluster</a> 采用基于 <strong>2PC 协议</strong>实现的全同步复制，MySQL NDB Cluster 基于 NDB 存储引擎，InnoDB 存储引擎不支持全同步复制。采用全同步复制的事务要求全部节点同意后才提交，对于共 n 个节点的集群，最多能容忍 n-1 个节点故障。</li>
<li>全同步复制相对异步复制、半同步复制的性能最差，半同步复制介于异步复制和全同步复制之间。基于 Paxos 协议实现的组复制和基于 2PC 协议实现的全同步复制，都是强一致性，但组复制的性能优于全同步复制。</li>
</ul>
</li>
<li><strong>副本读取策略</strong>：Slave 节点可以用于处理读请求，需要依赖客户端或代理将写请求路由到 Master 节点，将读请求路由到 Slave 节点，从而实现<strong>读写分离</strong>，实现对读请求处理能力的水平扩展。</li>
</ul>
</li>
<li><strong>请求路由寻址</strong>：可以将读请求路由到 Slave 节点，可以实现读写分离
<ul>
<li>基于客户端的读写路由：MySQL Connector/J (JDBC) 3.1.7（2005.02 发布）开始支持读写分离，支持将读请求负载均衡到从库<sup class="footnote-ref"><a href="#fn3" id="fnref3">[3]</a></sup>。</li>
<li>基于代理的读写路由：MySQL Router 也支持读写分离（Read/Write Splitting）<sup class="footnote-ref"><a href="#fn4" id="fnref4">[4]</a></sup>。</li>
</ul>
</li>
<li><strong>集群配置和协调</strong>：
<ul>
<li>分片策略在新建表时的 SQL 语句中指定；复制策略在配置文件中指定</li>
<li><strong>高可用方案</strong>：实现主从自动故障切换
<ul>
<li>MGR（MySQL Group Replication）：MySQL 5.7 提供官方高可用方案，基于 Paxos 协议实现节点间的数据复制，最多能容忍不超过半数的节点故障。</li>
<li><a target="_blank" rel="noopener" href="https://github.com/yoshinorim/mha4mysql-manager">MHA</a>（Master High Availability）：在 MySQL 官方推出在 MGR 之前，最流行的第三方高可用方案，<a target="_blank" rel="noopener" href="https://yoshinorimatsunobu.blogspot.com/2011/07/announcing-mysql-mha-mysql-master-high.html">2011.07</a> 最早对外发布，实现 Master 节点的自动故障切换。</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>MySQL InnoDB Cluster 架构，如下图所示<sup class="footnote-ref"><a href="#fn5" id="fnref5">[5]</a></sup>：</p>
<p><img src="media/innodb_cluster_overview.png" alt="MySQL InnoDB Cluster 架构"></p>
<p>MySQL 等传统关系数据库支持<strong>表分区</strong>（<a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/partitioning.html">partition</a>），但原生不支持<strong>分片</strong>（sharding），拆分后的表分区都分布在同一个服务器节点上。为了解决数据库的水平扩展问题，出现很多数据库分片方案。其中一类是基于传统关系数据库的“分库分表”中间件，如 <a target="_blank" rel="noopener" href="https://github.com/vitessio/vitess">Vitess</a>（基于代理服务器）、阿里 <a target="_blank" rel="noopener" href="https://github.com/alibaba/tb_tddl">TDDL</a>（基于客户端库）、阿里 <a target="_blank" rel="noopener" href="https://github.com/alibaba/cobar">Cobar</a>/DRDS（基于代理服务器）、<a target="_blank" rel="noopener" href="https://github.com/apache/shardingsphere">ShardingSphere</a>（包括基于客户端库的 ShardingSphere-JDBC 和基于代理服务器 ShardingSphere-Proxy）等。另外一类是非关系型的 <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/NoSQL">NoSQL</a> 数据库，如 BigTable、Dynamo、HBase、Cassandra 等。以及采用全新架构的 <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/NewSQL">NewSQL</a> 数据库，如 Google Spanner、CockroachDB、TiDB 等；或基于云服务的 NewSQL 数据库，如 Amazon Aurora、阿里 PolarDB 等。</p>
<h1 id="Redis（2009）">Redis（2009）</h1>
<p><strong>Redis 的数据分片和复制的历史演进时间线</strong>：</p>
<ul>
<li>2009.09，Redis 1.0 发布，开始支持主从节点数据复制，参见官方文档 <a target="_blank" rel="noopener" href="https://redis.io/docs/management/replication/">doc</a></li>
<li>2013.11，Redis 2.8 发布，开始提供 Redis Sentinel，用于监控各个 Redis 节点，实现主从节点自动故障切换，参见官方文档 <a target="_blank" rel="noopener" href="https://redis.io/docs/management/sentinel/">doc</a></li>
<li>2015.04，Redis 3.0 发布，开始提供 Redis Cluster，实现数据分片，参见官方文档 <a target="_blank" rel="noopener" href="https://redis.io/docs/management/scaling/">doc</a></li>
</ul>
<p><strong>Redis 的数据分片和复制策略</strong><sup class="footnote-ref"><a href="#fn6" id="fnref6">[6]</a></sup><sup class="footnote-ref"><a href="#fn7" id="fnref7">[7]</a></sup><sup class="footnote-ref"><a href="#fn8" id="fnref8">[8]</a></sup><sup class="footnote-ref"><a href="#fn9" id="fnref9">[9]</a></sup><sup class="footnote-ref"><a href="#fn10" id="fnref10">[10]</a></sup>：</p>
<ul>
<li><strong>分片策略</strong>：基于 Redis Cluster 实现数据分片
<ul>
<li><strong>分片术语命名</strong>：哈希槽（hash slot）
<ul>
<li>将全量数据拆分到多个哈希槽中。</li>
</ul>
</li>
<li><strong>键-分片的分配关系</strong>：按 Hash 拆分，基于哈希槽，哈希槽的总数固定为 <code>16384</code> (2^14)。
<ul>
<li>某 key 分配的哈希槽的计算公式：<code>HASH_SLOT = CRC16(key) mod 16384</code>。</li>
</ul>
</li>
<li><strong>分片-机器的分配关系</strong>：手动配置哈希槽与服务器节点的分配关系
<ul>
<li>相关命令：<a target="_blank" rel="noopener" href="https://redis.io/commands/cluster-addslots/">cluster addslots</a>（分配槽给某节点）、<a target="_blank" rel="noopener" href="https://redis.io/commands/cluster-slots/">cluster slots</a>（查看槽分配信息）等</li>
<li>创建集群并自动分配槽的简化操作的命令工具：<code>redis-cli --cluster create --cluster-replicas </code>（Redis &gt;= 5.0）或 <code>./redis-trib.rb create --replicas</code>（Redis &lt; 5.0）</li>
</ul>
</li>
<li><strong>分片再均衡策略</strong>：手动 reshard
<ul>
<li>相关命令：<a target="_blank" rel="noopener" href="https://redis.io/commands/cluster-setslot/">cluster setslot</a>（设置迁移槽状态）、<a target="_blank" rel="noopener" href="https://redis.io/commands/cluster-getkeysinslot/">cluster getkeysinslot</a>（获取属于某槽的 keys）、<a target="_blank" rel="noopener" href="https://redis.io/commands/migrate/">migrate</a>（迁移某 key 数据）等</li>
<li>简化操作的命令工具：<code>redis-cli --cluster reshard</code>（Redis &gt;= 5.0）或 <code>./redis-trib.rb reshard</code>（Redis &lt; 5.0）</li>
</ul>
</li>
</ul>
</li>
<li><strong>复制策略</strong>：主从（Master/Slave）模式，服务器节点区分主从（Master/Slave）两种角色，由一个 Master 节点和零到多个 Slave 节点组成复制组，Master 节点负责处理写和读请求，Slave 库默认不可写，复制组内的节点数据保持同步。
<ul>
<li><strong>复制单位</strong>：以服务器节点（机器）为单位</li>
<li><strong>复制系数</strong>：即复制组内的服务器节点数量</li>
<li><strong>副本更新传播策略</strong>：默认异步复制，通过 <a target="_blank" rel="noopener" href="https://redis.io/commands/wait/">wait</a>、<a target="_blank" rel="noopener" href="https://redis.io/commands/waitaof/">waitaof</a> 命令支持同步复制。</li>
<li><strong>副本读取策略</strong>：Slave 节点可以用于处理读请求，需要依赖客户端将写请求路由到 Master 节点，将读请求路由到 Slave 节点，从而实现<strong>读写分离</strong>，实现对读请求处理能力的水平扩展。Redis 默认是异步复制，从副本节点中读到的数据可能是旧的，Redis 本身性能非常高，一般不建议开启读写分离。
<ul>
<li><strong>副本是否可读</strong>：非 Redis Cluster 模式下，主库可写可读，从库默认不可写可读。因为历史原因从库可以配置为可写，但修改副本会导致主从库数据不一致，不推荐开启，参见文档 <a target="_blank" rel="noopener" href="https://redis.io/docs/management/replication/#read-only-replica">doc</a>。在 Redis Cluster 模式下，Slave 节点默认不接受任何读写请求，发送过来的键命令会重定向到负责槽的 Master 节点上。<a target="_blank" rel="noopener" href="https://redis.io/commands/readonly/">readonly</a> 命令允许将读请求重定向到 Slave 节点。</li>
<li><strong>读写分离</strong>：Lettuce 客户端库的 <a target="_blank" rel="noopener" href="https://github.com/lettuce-io/lettuce-core/wiki/ReadFrom-Settings">ReadFrom</a> 参数（默认 <code>MASTER</code>），Redisson 客户端库的 <a target="_blank" rel="noopener" href="https://github.com/redisson/redisson/wiki/2.-configuration">readMode</a> 参数（默认 <code>SLAVE</code>），支持将读请求路由到 Slave 节点。Jedis 客户端库暂时<a target="_blank" rel="noopener" href="https://github.com/redis/jedis/issues/3484">不支持</a> 读 Slave 节点，只支持读 Master 节点。</li>
</ul>
</li>
</ul>
</li>
<li><strong>请求路由寻址</strong>：
<ul>
<li><strong>基于客户端的分片路由</strong>：在 Redis Cluster 模式下，需要客户端实现分片的路由寻址。Redis 接收任何键相关命令时首先计算键对应的槽，再根据槽找出所对应的节点，如果节点是自身，则处理键命令；否则回复 MOVED 重定向错误，通知客户端请求正确的节点。为了避免重定向错误，一般客户端（Jedis、Lettuce、Redisson 等）都会在本地缓存槽与节点的分配关系，即缓存路由信息，然后客户端基于缓存的路由信息直接将命令发送到键所属的节点。</li>
</ul>
</li>
<li><strong>集群配置和协调</strong>：
<ul>
<li>Redis Cluster 采用<strong>去中心化架构</strong>，每个节点都维护全量元数据，节点间采用 Gossip 协议同步元数据，同步的元数据包括集群节点成员、槽分配信息、节点主从角色、节点存活状态等。</li>
<li><strong>自动选举主节点</strong>
<ul>
<li>Redis Cluster 自身实现了高可用方案，如果 Master 节点出现故障，支持自动从 Slave 节点选举新的 Master 节点，实现主从节点自动故障切换。</li>
<li>在非 Redis Cluster 模式下，Redis 的高可用方案是 Redis Sentinel，Sentinel 监控各个 Redis 节点，实现主从节点自动故障切换。</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Redis Cluster 架构与分区和副本分布示例，如下图所示：</p>
<p><img src="media/redis-cluster-ha-architecture.png" alt="Redis Cluster 架构与分区和副本分布示例"></p>
<h1 id="Elasticsearch（2010）">Elasticsearch（2010）</h1>
<p><strong>Elasticsearch 的数据分片和复制策略</strong><sup class="footnote-ref"><a href="#fn11" id="fnref11">[11]</a></sup><sup class="footnote-ref"><a href="#fn12" id="fnref12">[12]</a></sup>：</p>
<ul>
<li><strong>分片策略</strong>：
<ul>
<li><strong>分片术语命名</strong>：分片（shard）
<ul>
<li>将单个索引数据拆分到多个分片中</li>
</ul>
</li>
<li><strong>键-分片的分配关系</strong>：按 Hash 拆分
<ul>
<li>分片号的<a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/8.11/mapping-routing-field.html">计算公式</a>为（简化后）：<code>shard_num = hash(_routing) % num_primary_shards</code>。默认情况下，哈希函数采用 Murmur3 算法，<code>_routing</code> 值为文档 <code>_id</code>，<code>num_primary_shards</code> 值为 <a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/8.11/index-modules.html#index-number-of-shards">number_of_shards</a>， <code>number_of_shards</code> 配置项是在创建该索引时配置的分片总数，ES &gt;= 7.0 默认值 <code>1</code>，ES &lt; 7.0 默认值 <code>5</code>。</li>
<li>相关源码：<a target="_blank" rel="noopener" href="https://github.com/elastic/elasticsearch/blob/v8.11.0/server/src/main/java/org/elasticsearch/cluster/routing/IndexRouting.java">IndexRouting</a>（<a target="_blank" rel="noopener" href="https://javadoc.io/doc/org.elasticsearch/elasticsearch/8.11.0/org.elasticsearch.server/org/elasticsearch/cluster/routing/IndexRouting.html">javadoc</a>）</li>
</ul>
</li>
<li><strong>分片-机器的分配关系</strong>：默认自动将分片均衡分配到各个节点。分配考虑的权重因素包括节点内的总分片数量、节点内的该索引的分片数量等。分片分配策略由分片分配器（ShardsAllocator）实现，分片分配器职责是分配未指定的分片、移动分片和重新均衡分片。触发分片分配的时机包括索引增删、节点增删、手工 reroute、副本数量改变、集群重启。
<ul>
<li>Elasticsearch 8.6.0 开始，默认分片分配器类型是 <code>desired_balance</code>，8.6.0 之前默认是 <code>balanced</code>，0.90.0 之前默认是 <code>even_shard</code>（在 Elasticsearch 2.0 被删除），由配置项 <code>cluster.routing.allocation.type</code> 控制。</li>
<li>相关源码：AllocationService#reroute（<a target="_blank" rel="noopener" href="https://javadoc.io/doc/org.elasticsearch/elasticsearch/8.11.0/org.elasticsearch.server/org/elasticsearch/cluster/routing/allocation/AllocationService.html">javadoc</a>）、<a target="_blank" rel="noopener" href="https://github.com/elastic/elasticsearch/blob/v8.11.0/server/src/main/java/org/elasticsearch/cluster/routing/allocation/allocator/ShardsAllocator.java">ShardsAllocator</a>（<a target="_blank" rel="noopener" href="https://javadoc.io/doc/org.elasticsearch/elasticsearch/8.11.0/org.elasticsearch.server/org/elasticsearch/cluster/routing/allocation/allocator/ShardsAllocator.html">javadoc</a>）、<a target="_blank" rel="noopener" href="https://github.com/elastic/elasticsearch/blob/v8.11.0/server/src/main/java/org/elasticsearch/cluster/routing/allocation/allocator/BalancedShardsAllocator.java">BalancedShardsAllocator</a>（<a target="_blank" rel="noopener" href="https://javadoc.io/doc/org.elasticsearch/elasticsearch/8.11.0/org.elasticsearch.server/org/elasticsearch/cluster/routing/allocation/allocator/BalancedShardsAllocator.html">javadoc</a>）、<a target="_blank" rel="noopener" href="https://github.com/elastic/elasticsearch/blob/v8.11.0/server/src/main/java/org/elasticsearch/cluster/routing/allocation/allocator/DesiredBalanceShardsAllocator.java">DesiredBalanceShardsAllocator</a>（<a target="_blank" rel="noopener" href="https://javadoc.io/doc/org.elasticsearch/elasticsearch/8.11.0/org.elasticsearch.server/org/elasticsearch/cluster/routing/allocation/allocator/DesiredBalanceShardsAllocator.html">javadoc</a>）、<a target="_blank" rel="noopener" href="https://github.com/elastic/elasticsearch/blob/v1.7.0/src/main/java/org/elasticsearch/cluster/routing/allocation/allocator/EvenShardsCountAllocator.java">EvenShardsCountAllocator</a></li>
</ul>
</li>
<li><strong>分片再均衡策略</strong>：默认自动再均衡，由分片分配器（ShardsAllocator）实现</li>
</ul>
</li>
<li><strong>复制策略</strong><sup class="footnote-ref"><a href="#fn13" id="fnref13">[13]</a></sup><sup class="footnote-ref"><a href="#fn14" id="fnref14">[14]</a></sup>：主备（Primary/Backup）模式，或称为 Primary/Replica、Primary/Secondary、Master/Slave、Leader/Follower 等。分片副本分为主副两种角色，由一个 Primary 分片和零到多个 Replica 分片组成复制组，Primary 分片负责承担写请求，读请求由 Primary 分片和 Replica 分片共同承担，复制组内的分片数据保持同步。
<ul>
<li><strong>复制单位</strong>：以分片为单位</li>
<li><strong>复制系数</strong>：由配置项 <a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/8.11/index-modules.html#dynamic-index-number-of-replicas">number_of_replicas</a> 控制，即 Replica 分片的总数，默认值 <code>1</code>，即一个 Primary 分片和一个 Replica 分片</li>
<li><strong>副本更新传播策略</strong>：复制策略类似于微软的 PacificA 复制协议，Kafka 的<a target="_blank" rel="noopener" href="https://kafka.apache.org/36/documentation.html#replication">分片复制</a>也类似于 PacificA 协议。
<ul>
<li><strong>Master 节点</strong>维护<strong>同步副本集合</strong>（in-sync replica set）。协调节点将写操作请求转发到 Primary 分片上，在 Primary 分片上执行<strong>写入前先检查</strong>处于活动副本（active shard）数（活动副本近似等于同步副本<sup class="footnote-ref"><a href="#fn15" id="fnref15">[15]</a></sup>），如果小于最小活动副本数（由配置项 <code>wait_for_active_shards</code> 控制，默认 <code>1</code>，只等待 Primary 分片），则等待直到数量满足或超时。检查通过后，在 Primary 分片上执行操作，执行成功后，转发该操作到当前同步副本集合的所有 Replica 分片。如果有多个 Replica 分片，则会并行转发。等所有的 Replica 分片执行操作并响应（可能成功，也可能失败）后，Primary 分片会把请求响应返回给协调节点，协调节点返回给客户端。如果 Replica 写入失败，会执行重试逻辑，但最终并不强求一定要在多少个节点写入成功。
<ul>
<li>如果在 Primary 分片上执行写入操作失败，Primary 分片所在节点将发送消息到 Marter 节点。这个索引操作会等待（默认为最多一分钟）Master 节点提升一个 Replica 分片为新的 Primary 分片。然后这个操作会被转发给新的 Primary 分片。</li>
<li>如果在 Replica 分片上执行写入操作失败，Primary 分片会向 Marter 节点发送一条消息，请求从同步副本集合中删除有问题的分片。只有在 Master 节点确认删除分片后，Primary 分片才会确认该操作。请注意，Master 节点还将指示另一个节点开始构建新的分片副本，以便将系统恢复到正常状态。</li>
</ul>
</li>
</ul>
</li>
<li><strong>副本读取策略</strong>：Primary 分片和同步的 Replica 分片都可以承担读请求，若 Replica 分片被移出同步副本集合，将不再承担读请求。</li>
</ul>
</li>
<li><strong>请求路由寻址</strong><sup class="footnote-ref"><a href="#fn16" id="fnref16">[16]</a></sup>：集群中任意节点隐式都是<strong>协调节点</strong>（Coordinating Node），并且节点的协调角色无法被禁用，每个节点都有能力处理任意请求，每个节点都知道集群中任一文档位置。客户端请求可以发送到集群的任何节点，收到请求的节点扮演协调节点角色，将请求转发给保存数据的数据节点。各个数据节点在本地执行请求，并将结果返回协调节点。协调节点收集数据，将每个数据节点的结果合并为单个全局结果，并将结果返回给客户端。</li>
<li><strong>集群配置和协调</strong>：由 <strong>Master 节点</strong> 负责
<ul>
<li>由 <strong>Master 节点</strong>（Master Node）负责存储内容路由信息、配置信息等集群元数据，以及负责轻量级集群范围的操作，包括创建或删除索引、集群成员管理、分片分配等。如果集群元数据发生变更，Master 节点会把变更广播到集群的其他节点，让每个节点上的集群元数据保持同步。</li>
<li><strong>Master 节点自动选举</strong><sup class="footnote-ref"><a href="#fn17" id="fnref17">[17]</a></sup><sup class="footnote-ref"><a href="#fn18" id="fnref18">[18]</a></sup>：在集群启动或 Master 节点故障时，会从全部有 Master 资格的节点（Master-eligible Node）中自动选举中新的 Master 节点，选举基于过半（quorum）投票决策。Elasticsearch 7.0 之前节点选举默认基于内置的 Zen Discovery 模块，底层是变种的 Bully 算法，Elasticsearch 7.0（2019.04 发布）开始重新实现，类似于 Raft 算法。</li>
</ul>
</li>
</ul>
<p><img src="media/elasticsearch-architecture.png" alt="Elasticsearch 架构与分片和副本分布示例"></p>
<h1 id="HBase（2007）">HBase（2007）</h1>
<p><strong>HBase 的数据分片和复制的历史演进时间线</strong>：</p>
<ul>
<li>2007.02，HBase 宣布在 Hadoop 项目中成立，成为 Hadoop 的子项目，参见 HADOOP-1045/<a target="_blank" rel="noopener" href="https://issues.apache.org/jira/browse/HBASE-287">HBASE-287</a>、first <a target="_blank" rel="noopener" href="https://github.com/apache/hbase/tree/948d0cdec4fb35d70404b9b6e27743616400656d">commit</a>。HBase 是 Google BigTable 的开源实现版，采用与 BigTable 类似的数据模型。表支持分片，单个表被拆分为多个 HRegion。</li>
<li>2011.01，HBase 0.90 发布，开始支持集群间复制（inter-cluster replication），复制方式采用异步复制。</li>
<li><a target="_blank" rel="noopener" href="https://blogsarchive.apache.org/hbase/entry/start_of_a_new_era">2015.02</a>，HBase 1.0 发布，开始实验性支持 Region 复制（region replication），也叫时间线一致的高可用读（timeline consistent high available reads），参见 <a target="_blank" rel="noopener" href="https://issues.apache.org/jira/browse/HBASE-10070">HBASE-10070</a>。该特性发布后，陆陆续续修复了一些 bug，比如 <a target="_blank" rel="noopener" href="https://issues.apache.org/jira/browse/HBASE-18223">HBASE-18223</a>，直到 HBase 1.4 才稳定下来。</li>
</ul>
<p><strong>HBase 的数据分片和复制策略</strong><sup class="footnote-ref"><a href="#fn19" id="fnref19">[19]</a></sup><sup class="footnote-ref"><a href="#fn20" id="fnref20">[20]</a></sup>：</p>
<ul>
<li><strong>分片策略</strong>：
<ul>
<li><strong>分片术语命名</strong>：Region</li>
<li><strong>键-分片的分配关系</strong>
<ul>
<li><strong>Range 拆分</strong>：根据 Region 的文件大小阈值等负载因素自动触发 Region 拆分，配置项 <code>hbase.regionserver.region.split.policy</code>，Region 的拆分策略：
<ul>
<li>HBase 0.94 之前，默认是 <a target="_blank" rel="noopener" href="https://github.com/apache/hbase/blob/branch-2.5/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/ConstantSizeRegionSplitPolicy.java">ConstantSizeRegionSplitPolicy</a>（<a target="_blank" rel="noopener" href="https://hbase.apache.org/2.5/devapidocs/org/apache/hadoop/hbase/regionserver/ConstantSizeRegionSplitPolicy.html">javadoc</a>），当一个 Region 最大文件大小超过设置阈值（<code>hbase.hregion.max.filesize</code>，默认 <code>1G</code>），触发 Region 分裂。</li>
<li>HBase 0.94 开始，默认 <a target="_blank" rel="noopener" href="https://github.com/apache/hbase/blob/branch-2.5/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/IncreasingToUpperBoundRegionSplitPolicy.java">IncreasingToUpperBoundRegionSplitPolicy</a>（<a target="_blank" rel="noopener" href="https://hbase.apache.org/2.5/devapidocs/org/apache/hadoop/hbase/regionserver/IncreasingToUpperBoundRegionSplitPolicy.html">javadoc</a>）</li>
<li>HBase 2.0 开始，默认 <a target="_blank" rel="noopener" href="https://github.com/apache/hbase/blob/branch-2.5/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/SteppingSplitPolicy.java">SteppingSplitPolicy</a>（<a target="_blank" rel="noopener" href="https://hbase.apache.org/2.5/devapidocs/org/apache/hadoop/hbase/regionserver/SteppingSplitPolicy.html">javadoc</a>）。如果 Region 个数等于 1，分裂阈值为 flush size * 2，否则阈值为最大文件大小。flush size 的配置项是 <code>hbase.hregion.memstore.flush.size</code>，默认 128MB。</li>
</ul>
</li>
<li><strong>Region 合并</strong>：使用 <code>merge_region</code> 命令可以人为触发执行 Region 合并。</li>
</ul>
</li>
<li><strong>分片-机器的分配关系</strong><sup class="footnote-ref"><a href="#fn21" id="fnref21">[21]</a></sup>：根据负载均衡策略自动分配放置
<ul>
<li>配置项 <code>hbase.master.loadbalancer.class</code>，负载均衡策略
<ul>
<li>HBase 1.0 之前，默认 <a target="_blank" rel="noopener" href="https://github.com/apache/hbase/blob/branch-2.5/hbase-server/src/main/java/org/apache/hadoop/hbase/master/balancer/SimpleLoadBalancer.java">SimpleLoadBalancer</a>（<a target="_blank" rel="noopener" href="https://hbase.apache.org/2.5/devapidocs/org/apache/hadoop/hbase/master/balancer/SimpleLoadBalancer.html">javadoc</a>），策略是保证每个 RegionServer 的 Region 个数基本相等。</li>
<li>HBase 1.0 开始，默认 <a target="_blank" rel="noopener" href="https://github.com/apache/hbase/blob/branch-2.5/hbase-server/src/main/java/org/apache/hadoop/hbase/master/balancer/StochasticLoadBalancer.java">StochasticLoadBalancer</a>（<a target="_blank" rel="noopener" href="https://hbase.apache.org/2.5/devapidocs/org/apache/hadoop/hbase/master/balancer/StochasticLoadBalancer.html">javadoc</a>），不再单纯根据 Region 个数，而是由多种独立的影响负载因素加权计算的复合值。</li>
<li>相关源码：<a target="_blank" rel="noopener" href="https://github.com/apache/hbase/blob/branch-2.5/hbase-server/src/main/java/org/apache/hadoop/hbase/master/assignment/AssignmentManager.java">AssignmentManager</a>（<a target="_blank" rel="noopener" href="https://hbase.apache.org/2.5/devapidocs/org/apache/hadoop/hbase/master/assignment/AssignmentManager.html">javadoc</a>）</li>
</ul>
</li>
</ul>
</li>
<li><strong>分片再均衡策略</strong>：根据负载均衡策略自动 reshard</li>
</ul>
</li>
<li><strong>集群间的复制策略</strong><sup class="footnote-ref"><a href="#fn22" id="fnref22">[22]</a></sup>：类似于 MySQL 的主从复制，HBase 复制，区分主集群（master cluster）和从集群（slave cluster）。主集群也称为源集群（source cluster）；从集群也称为目标集群（target cluster）或 peer 集群（peer cluster）。复制的主集群与从集群规模大小通常不一样，主集群会使用随机选择复制目标 HRegionServer 来平衡发送到每台 HRegionServer 的数据量。主集群内的每个 HRegionServer 都将自己的 HLog 日志（WAL 日志）的变更<strong>推送</strong>（push）到目标集群的其他 HRegionServer。
<ul>
<li><strong>复制单位</strong>：以整个集群为服务单位</li>
<li><strong>复制系数</strong>：与配置的从集群的数量直接相关</li>
<li><strong>副本更新传播策略</strong>：采用异步复制（asynchronous replication），HBase 3.0 开始支持同步复制（<a target="_blank" rel="noopener" href="https://hbase.apache.org/book.html#syncreplication">synchronous replication</a>），参见 <a target="_blank" rel="noopener" href="https://issues.apache.org/jira/browse/HBASE-19064">HBASE-19064</a>。</li>
</ul>
</li>
<li><strong>分片的复制策略</strong><sup class="footnote-ref"><a href="#fn23" id="fnref23">[23]</a></sup><sup class="footnote-ref"><a href="#fn24" id="fnref24">[24]</a></sup><sup class="footnote-ref"><a href="#fn25" id="fnref25">[25]</a></sup>：副本区分两种类型 Primary Region 副本和 Secondary Region 副本，同一 Region 的各个副本分布在不同的 HRegionServer 上，只有 Primary Region 副本可以接收客户端的写请求，Secondary Region 副本对客户端总是只读。默认不开启 Region 复制，在同个集群内只有单个 Region 副本，若开启，Region 副本将在集群内复制。
<ul>
<li><strong>复制单位</strong>：以分片为单位</li>
<li><strong>复制系数</strong>：在创建表时可以指定某表的复制系数，并且支持动态修改，默认复制系数为 1。
<ul>
<li>如 <code>create 't1', &#123;REGION_REPLICATION =&gt; 2&#125;</code> 和 <code>alter 't1', &#123;REGION_REPLICATION =&gt; 1&#125;</code></li>
</ul>
</li>
<li><strong>副本更新传播策略</strong>：采用异步复制，更新传播的具体实现机制有两种，storefile refresher 和 async wal replication。
<ul>
<li>配置项 <code>hbase.regionserver.storefile.refresh.period</code>，默认值 0，若值非零，表示开启 storefile refresher。</li>
<li>配置项 <code>hbase.region.replica.replication.enabled</code>，默认值 <code>false</code>，若值为 <code>true</code>，表示开启 async wal replication。</li>
</ul>
</li>
<li><strong>副本读取策略</strong>：读取一致性等级（consistency level）的分两种，<code>STRONG</code>（强）和 <code>TIMELINE</code>（时间线），默认强一致性。每次读取操作都可以设置不同的一致性等级。在强一致性等级下，只读取 Primary Region 副本。在时间线一致性等级下，先尝试读取 Primary Region 副本，在很短的间隔（默认为 10 毫秒），如果 Primary Region 副本没有响应，则还将发送 Secondary Region 副本的并行 RPC，从最先完成的 RPC 返回结果。结果可能从 Primary Region 副本中读到，也可能从 Secondary Region 副本中读到。Primary Region 副本总最新的，而 Secondary Region 副本可能过时。
<ul>
<li>相关源码：<a target="_blank" rel="noopener" href="https://hbase.apache.org/2.5/devapidocs/org/apache/hadoop/hbase/client/Consistency.html">Consistency</a></li>
</ul>
</li>
</ul>
</li>
<li><strong>请求路由寻址</strong>：
<ul>
<li>HBase 客户端会将 Region 路由信息缓存到本地，客户端可以直接根据本地缓存的 Region 路由信息将请求路由到正确的 HRegionServer 节点上。绝大部分的请求都属于这种情况。如果 Region 路由缓存为空，客户端先读取 ZooKeeper 上的 <code>hbase:meta</code> 表的 HRegionServer 访问地址，然后访问 HRegionServer 读取 Region 路由信息并缓存到本地。如 Region 路由缓存非空，但是根据缓存请求某 HRegionServer 后发现 Region 并不在该 HRegionServer 上，则说明缓存过期，需要读取最新的 <code>hbase:meta</code> 表数据，刷新缓存。
<ul>
<li>相关源码：<a target="_blank" rel="noopener" href="https://github.com/apache/hbase/blob/branch-2.5/hbase-client/src/main/java/org/apache/hadoop/hbase/client/MetaCache.java">MetaCache</a>（<a target="_blank" rel="noopener" href="https://hbase.apache.org/2.5/devapidocs/org/apache/hadoop/hbase/client/MetaCache.html">javadoc</a>）</li>
</ul>
</li>
</ul>
</li>
<li><strong>集群配置和协调</strong>：
<ul>
<li>HMaster 主要负责 HBase 系统管理，包括 table 的操作管理、Region 的负载均衡和迁移等。</li>
<li>ZooKeeper 用于实现 HMaster 高可用、维护元数据、实现分布式表锁等。元数据，包括全部的 HMaster 的主备节点信息、全部的 HRegionServer 节点信息、全部的表信息、元数据表 <code>hbase:meta</code> 的 HRegionServer 访问地址等。<code>hbase:meta</code> 表用于保存全部 Region 信息。</li>
</ul>
</li>
</ul>
<p>HBase 架构，如下图所示<sup class="footnote-ref"><a href="#fn20" id="fnref20:1">[20:1]</a></sup>：</p>
<p><img src="media/hbase-architecture.png" alt="HBase 架构"></p>
<h1 id="Cassandra（2008）">Cassandra（2008）</h1>
<p>Cassandra，分布式设计基于 Amazon Dynamo，数据模型基于 Google BigTable。</p>
<p><strong>Cassandra 的数据分片和复制策略</strong>：</p>
<ul>
<li><strong>分片策略</strong>：
<ul>
<li><strong>分片术语命名</strong>：虚拟节点（virtual node）</li>
<li><strong>键-分片的分配关系</strong>：按 Hash 拆分。基于虚拟节点，一种改进版的一致性哈希算法</li>
<li><strong>分片-机器的分配关系</strong>：手动配置每个物理节点包含的虚拟节点数（默认 256 个）</li>
<li><strong>分片副本-机器的分配关系</strong>：轮询（round-robin）分配
<ul>
<li><code>SimpleStrategy</code> 和 <code>NetworkTopologyStrategy</code></li>
</ul>
</li>
<li><strong>分片再均衡策略</strong>：自动 reshard
<ul>
<li>基于虚拟节点的一致性哈希，在节点加入或删除时触发自动 reshard</li>
</ul>
</li>
</ul>
</li>
<li><strong>复制策略</strong>：
<ul>
<li><strong>复制单位</strong>：以分片为单位</li>
<li><strong>复制系数</strong>：</li>
<li><strong>副本更新传播策略</strong>：</li>
</ul>
</li>
<li><strong>请求路由寻址</strong>：</li>
<li><strong>集群配置和协调</strong>：
<ul>
<li>采用<strong>去中心化架构</strong>，每个节点都维护全量元数据，节点间采用 Gossip 协议同步元数据</li>
</ul>
</li>
</ul>
<h1 id="TiDB（2017）">TiDB（2017）</h1>
<p>2017.10，TiDB 对外发布 1.0 GA，设计上受 Google 的 Spanner / F1 数据库启发。</p>
<p><strong>TiDB 的数据分片和复制策略</strong>：</p>
<ul>
<li><strong>分片策略</strong>：
<ul>
<li><strong>分片术语命名</strong>：Region</li>
<li><strong>键-分片的分配关系</strong>：按 Range 拆分</li>
<li><strong>分片-机器的分配关系</strong>：根据负载自动分片（auto-sharding）</li>
<li><strong>分片再均衡策略</strong>：自动 reshard
<ul>
<li>根据分区的数据量大小阈值触发自动拆分或合并</li>
</ul>
</li>
</ul>
</li>
<li><strong>复制策略</strong>：
<ul>
<li><strong>复制单位</strong>：以分片为单位</li>
<li><strong>复制系数</strong>：</li>
<li><strong>副本更新传播策略</strong>：基于 Raft 协议</li>
<li><strong>副本读取策略</strong>：</li>
</ul>
</li>
<li><strong>请求路由寻址</strong>：</li>
<li><strong>集群配置和协调</strong>：
<ul>
<li>由 PD Server 分配分区和维护元数据（包括分区和节点的分配信息）</li>
</ul>
</li>
</ul>
<h1 id="参考资料">参考资料</h1>
<p>数据密集型应用系统设计，Martin Kleppmann，2015，<a target="_blank" rel="noopener" href="https://book.douban.com/subject/30329536/">豆瓣</a>：第5章 数据复制，第6章 数据分区</p>
<hr class="footnotes-sep">
<section class="footnotes">
<ol class="footnotes-list">
<li id="fn1" class="footnote-item"><p>MySQL 8.0 Reference Manual: Chapter 24 Partitioning <a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/partitioning.html">https://dev.mysql.com/doc/refman/8.0/en/partitioning.html</a> <a href="#fnref1" class="footnote-backref">↩︎</a></p>
</li>
<li id="fn2" class="footnote-item"><p>MySQL 8.0 Reference Manual: Chapter 17 Replication <a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/replication.html">https://dev.mysql.com/doc/refman/8.0/en/replication.html</a> <a href="#fnref2" class="footnote-backref">↩︎</a></p>
</li>
<li id="fn3" class="footnote-item"><p>MySQL Connector/J Developer Guide: Chapter 9 Multi-Host Connections: 9.4 Configuring Source/Replica Replication with Connector/J <a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/connector-j/en/connector-j-source-replica-replication-connection.html">https://dev.mysql.com/doc/connector-j/en/connector-j-source-replica-replication-connection.html</a> <a href="#fnref3" class="footnote-backref">↩︎</a></p>
</li>
<li id="fn4" class="footnote-item"><p>MySQL Router: Chapter 3 Deploying MySQL Router: 3.5 Read/Write Splitting <a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/mysql-router/8.3/en/router-read-write-splitting.html">https://dev.mysql.com/doc/mysql-router/8.3/en/router-read-write-splitting.html</a> <a href="#fnref4" class="footnote-backref">↩︎</a></p>
</li>
<li id="fn5" class="footnote-item"><p>MySQL 8.0 Reference Manual: Chapter 21 InnoDB Cluster <a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/mysql-innodb-cluster-introduction.html">https://dev.mysql.com/doc/refman/8.0/en/mysql-innodb-cluster-introduction.html</a> <a href="#fnref5" class="footnote-backref">↩︎</a></p>
</li>
<li id="fn6" class="footnote-item"><p>Redis 3.2 开发与运维，付磊、张益军，2017，<a target="_blank" rel="noopener" href="https://book.douban.com/subject/26971561/">豆瓣</a>：第6章 复制，第9章 哨兵，第10章 集群 <a href="#fnref6" class="footnote-backref">↩︎</a></p>
</li>
<li id="fn7" class="footnote-item"><p>Redis Documentation &gt; Manage Redis &gt; Redis replication <a target="_blank" rel="noopener" href="https://redis.io/docs/management/replication/">https://redis.io/docs/management/replication/</a> <a href="#fnref7" class="footnote-backref">↩︎</a></p>
</li>
<li id="fn8" class="footnote-item"><p>Redis Documentation &gt; Manage Redis &gt; Scale with Redis Cluster <a target="_blank" rel="noopener" href="https://redis.io/docs/management/scaling/">https://redis.io/docs/management/scaling/</a> <a href="#fnref8" class="footnote-backref">↩︎</a></p>
</li>
<li id="fn9" class="footnote-item"><p>Redis Documentation &gt; Reference &gt; Redis cluster specification <a target="_blank" rel="noopener" href="https://redis.io/docs/reference/cluster-spec/">https://redis.io/docs/reference/cluster-spec/</a> <a href="#fnref9" class="footnote-backref">↩︎</a></p>
</li>
<li id="fn10" class="footnote-item"><p>Redis Documentation &gt; Manage Redis &gt; High availability with Redis Sentinel <a target="_blank" rel="noopener" href="https://redis.io/docs/management/sentinel/">https://redis.io/docs/management/sentinel/</a> <a href="#fnref10" class="footnote-backref">↩︎</a></p>
</li>
<li id="fn11" class="footnote-item"><p>Elasticsearch 6.1 源码解析与优化实战，张超，2019，<a target="_blank" rel="noopener" href="https://book.douban.com/subject/30386800/">豆瓣</a> <a href="#fnref11" class="footnote-backref">↩︎</a></p>
</li>
<li id="fn12" class="footnote-item"><p>Elasticsearch 2.x 权威指南：分布式文档存储 <a target="_blank" rel="noopener" href="https://www.elastic.co/guide/cn/elasticsearch/guide/current/distributed-docs.html">https://www.elastic.co/guide/cn/elasticsearch/guide/current/distributed-docs.html</a> <a href="#fnref12" class="footnote-backref">↩︎</a></p>
</li>
<li id="fn13" class="footnote-item"><p>Elasticsearch Guide &gt; Reading and Writing documents <a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/8.12/docs-replication.html">https://www.elastic.co/guide/en/elasticsearch/reference/8.12/docs-replication.html</a> <a href="#fnref13" class="footnote-backref">↩︎</a></p>
</li>
<li id="fn14" class="footnote-item"><p>2018-04 阿里王怀远：Elasticsearch分布式一致性原理剖析(三)-Data篇 <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/35285514">https://zhuanlan.zhihu.com/p/35285514</a> <a href="#fnref14" class="footnote-backref">↩︎</a></p>
</li>
<li id="fn15" class="footnote-item"><p>2020-06 Clarifying the difference between Active shards and in-sync copies <a target="_blank" rel="noopener" href="https://discuss.elastic.co/t/238716">https://discuss.elastic.co/t/238716</a> <a href="#fnref15" class="footnote-backref">↩︎</a></p>
</li>
<li id="fn16" class="footnote-item"><p>Elasticsearch Guide &gt; Node <a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/8.12/modules-node.html">https://www.elastic.co/guide/en/elasticsearch/reference/8.12/modules-node.html</a> <a href="#fnref16" class="footnote-backref">↩︎</a></p>
</li>
<li id="fn17" class="footnote-item"><p>Elasticsearch Guide &gt; Quorum-based decision making <a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/8.12/modules-discovery-quorums.html">https://www.elastic.co/guide/en/elasticsearch/reference/8.12/modules-discovery-quorums.html</a> <a href="#fnref17" class="footnote-backref">↩︎</a></p>
</li>
<li id="fn18" class="footnote-item"><p>2019-03 Elasticsearch 集群协调迎来新时代（7.0） <a target="_blank" rel="noopener" href="https://www.elastic.co/cn/blog/a-new-era-for-cluster-coordination-in-elasticsearch">https://www.elastic.co/cn/blog/a-new-era-for-cluster-coordination-in-elasticsearch</a> <a href="#fnref18" class="footnote-backref">↩︎</a></p>
</li>
<li id="fn19" class="footnote-item"><p>HBase 2.x 原理与实践，胡争，2019，<a target="_blank" rel="noopener" href="https://book.douban.com/subject/34819650/">豆瓣</a> <a href="#fnref19" class="footnote-backref">↩︎</a></p>
</li>
<li id="fn20" class="footnote-item"><p>HBase 0.91 权威指南，Lars George，2011，<a target="_blank" rel="noopener" href="https://book.douban.com/subject/25784835/">豆瓣</a> <a href="#fnref20" class="footnote-backref">↩︎</a> <a href="#fnref20:1" class="footnote-backref">↩︎</a></p>
</li>
<li id="fn21" class="footnote-item"><p>Apache HBase Reference Guide: 72.2. Region-RegionServer Assignment <a target="_blank" rel="noopener" href="https://hbase.apache.org/book.html#regions.arch.assignment">https://hbase.apache.org/book.html#regions.arch.assignment</a> <a href="#fnref21" class="footnote-backref">↩︎</a></p>
</li>
<li id="fn22" class="footnote-item"><p>Apache HBase Reference Guide: 165. Cluster Replication <a target="_blank" rel="noopener" href="https://hbase.apache.org/book.html#_cluster_replication">https://hbase.apache.org/book.html#_cluster_replication</a> <a href="#fnref22" class="footnote-backref">↩︎</a></p>
</li>
<li id="fn23" class="footnote-item"><p>Apache HBase Reference Guide: 75. Timeline-consistent High Available Reads <a target="_blank" rel="noopener" href="https://hbase.apache.org/book.html#arch.timelineconsistent.reads">https://hbase.apache.org/book.html#arch.timelineconsistent.reads</a> <a href="#fnref23" class="footnote-backref">↩︎</a></p>
</li>
<li id="fn24" class="footnote-item"><p>2014-06 HBase Read High Availability Using Timeline-Consistent Region Replicas <a target="_blank" rel="noopener" href="https://www.slideshare.net/slideshow/features-session-1/35938207">https://www.slideshare.net/slideshow/features-session-1/35938207</a> <a href="#fnref24" class="footnote-backref">↩︎</a></p>
</li>
<li id="fn25" class="footnote-item"><p>2018-06 阿里杨文龙：深入解读 HBase2.0 新功能之高可用读 Region Replica <a target="_blank" rel="noopener" href="https://developer.aliyun.com/article/599162">https://developer.aliyun.com/article/599162</a> <a href="#fnref25" class="footnote-backref">↩︎</a></p>
</li>
</ol>
</section>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://nullwy.me/2023/12/website-scalability-reliability-resilience/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://static.nullwy.me/avatar.png">
      <meta itemprop="name" content="nullwy">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="nullwy's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/12/website-scalability-reliability-resilience/" class="post-title-link" itemprop="url">大型网站的稳定性、可靠性和韧性</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-12-25 10:36:00" itemprop="dateCreated datePublished" datetime="2023-12-25T10:36:00+08:00">2023-12-25</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%9E%B6%E6%9E%84/" itemprop="url" rel="index"><span itemprop="name">架构</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    <i class="far fa-comment"></i>
    <a title="disqus" href="/2023/12/website-scalability-reliability-resilience/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2023/12/website-scalability-reliability-resilience/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>14k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>12 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>为了应对负载的增长，提升系统性能，目前大型网站普遍都是分布式架构，采用微服务架构风格。分布式系统的最重要的架构特性是<strong>伸缩性</strong>（scalability），伸缩性的系统具备应对增长的工作负载的能力。关于性能和伸缩性，可以参阅笔者的文章《<a href="https://nullwy.me/2023/12/website-performance-scalability/">大型网站的性能和可伸缩性</a>》。相对于采用单体架构的系统，分布式系统中有大量的服务器及设备，各服务之间存在错综复杂的依赖关系，存在更多的不确定性。整个系统的故障率会随服务节点的增加而呈指数级增加，单一节点问题可能会被无限放大，日常运行过程中一定会伴随故障发生。所以构建分布式系统需要关注的另外一个重要架构特性是<strong>稳定性</strong>（stability）。有关减少系统故障以及快速从故障中恢复的工程实践，国内通常称为“稳定性建设”，而国外类似的工程实践更多称为“站点可靠性工程”（SRE, <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Site_reliability_engineering">Site reliability engineering</a>）。稳定性（stability）、可靠性（reliability）、韧性（resilience）、可用性（availability）等架构特性，相似并且相关，虽然严格区分的话，含义并不相同，但是很多时候在探讨这些架构特性时往往涵盖的是类似的内容。本文的内容主要是总结稳定性、可靠性、韧性这些架构特性的内涵，以及如何建设分布式系统的这些特性。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2023/12/website-scalability-reliability-resilience/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://nullwy.me/2023/12/website-performance-scalability/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://static.nullwy.me/avatar.png">
      <meta itemprop="name" content="nullwy">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="nullwy's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/12/website-performance-scalability/" class="post-title-link" itemprop="url">大型网站的性能和可伸缩性</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-12-08 21:08:00" itemprop="dateCreated datePublished" datetime="2023-12-08T21:08:00+08:00">2023-12-08</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%9E%B6%E6%9E%84/" itemprop="url" rel="index"><span itemprop="name">架构</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    <i class="far fa-comment"></i>
    <a title="disqus" href="/2023/12/website-performance-scalability/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2023/12/website-performance-scalability/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>12k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>11 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>互联网网站在初期用户量和访问量一般都很小，往往只需要采用最简单的技术架构就能对外提供稳定服务。最简单的架构通常采用的是单机应用服务器、单机数据库服务器这样的单体架构。成功的互联网网站，比如电商平台，流量、用户量、交易量等核心指标是呈指数增长的，所以就需要提升网站系统的性能，来应对更大的负载。通过向系统中增加资源来提升系统性能的能力，被称为可伸缩性（<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Scalability">scalability</a>）。为了提升系统的可伸缩性，典型的大型网站，比如 eBay、Amazon 和淘宝等，几乎都经历过从单体架构向分布式架构演进的过程。本文主要关注大型网站或 Web 服务这类系统，解释系统的性能和可伸缩性相关的核心概念，并介绍系统的性能指标、系统的扩展策略和分布式架构风格，同时也总结分析典型大型网站的可扩展性架构演进案例，案例包括 eBay、Amazon、淘宝等。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2023/12/website-performance-scalability/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://nullwy.me/2023/12/popular-websites-tech-stack/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://static.nullwy.me/avatar.png">
      <meta itemprop="name" content="nullwy">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="nullwy's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/12/popular-websites-tech-stack/" class="post-title-link" itemprop="url">流行互联网网站技术栈整理（万字长文）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-12-03 23:37:00" itemprop="dateCreated datePublished" datetime="2023-12-03T23:37:00+08:00">2023-12-03</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%9E%B6%E6%9E%84/" itemprop="url" rel="index"><span itemprop="name">架构</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    <i class="far fa-comment"></i>
    <a title="disqus" href="/2023/12/popular-websites-tech-stack/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2023/12/popular-websites-tech-stack/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>35k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>32 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>本文整理总结主要的流行互联网网站技术栈，以及这些网站的技术栈和架构的历史演进过程。涉及的网站大部分都是当前或曾经访问量或月活用户量 Top 的网站（参见 Similarweb 网站的统计<sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup>，或访问量 Top 10 网站的历史演变<sup class="footnote-ref"><a href="#fn2" id="fnref2">[2]</a></sup>，或 wiki 整理的至少 1 亿月活用户量的社交平台<sup class="footnote-ref"><a href="#fn3" id="fnref3">[3]</a></sup>）。国内网站或 APP 涵盖了主流<sup class="footnote-ref"><a href="#fn4" id="fnref4">[4]</a></sup>的阿里、腾讯、百度、美团、字节、京东等大厂的互联网产品。整理的技术栈主要是流行网站的服务端业务系统的技术栈，包括编程语言、数据库、RPC 框架等，同时也简单整理了大数据技术栈，前端和客户端技术栈等不涉及。除了对大部分流行网站的技术栈做系统性梳理外，本文还挑选部分有代表性的网站，对这些网站的技术栈和架构的历史演进做详细解析。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2023/12/popular-websites-tech-stack/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://nullwy.me/2023/11/amazon-architecture-evolution/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://static.nullwy.me/avatar.png">
      <meta itemprop="name" content="nullwy">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="nullwy's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/11/amazon-architecture-evolution/" class="post-title-link" itemprop="url">亚马逊网站架构演进</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-11-20 12:45:00" itemprop="dateCreated datePublished" datetime="2023-11-20T12:45:00+08:00">2023-11-20</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%9E%B6%E6%9E%84/" itemprop="url" rel="index"><span itemprop="name">架构</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    <i class="far fa-comment"></i>
    <a title="disqus" href="/2023/11/amazon-architecture-evolution/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2023/11/amazon-architecture-evolution/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>6.3k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>6 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="SOA-与微服务">SOA 与微服务</h1>
<p>Amazon，1994 年创立，早期网站是单服务、单数据库的单体架构的系统<sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup><sup class="footnote-ref"><a href="#fn2" id="fnref2">[2]</a></sup><sup class="footnote-ref"><a href="#fn3" id="fnref3">[3]</a></sup>，全部代码由 C++ 编写，编译成单个二进制文件，整个代码仓库被命名为 <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Obidos_(software)">Obidos</a>。Obidos 是底层是一个 Web 页面渲染引擎，是一个框架，业务逻辑基于这个框架开发，Obidos 渲染引擎和业务逻辑共同组成整个代码仓库。随着时间的推移，Obidos 变得越来越复杂，编译 Obidos 整个代码库耗时 12 小时，开发调试效率低下<sup class="footnote-ref"><a href="#fn2" id="fnref2:1">[2:1]</a></sup>。另外，全部业务逻辑在单个二进制文件中，导致紧耦合，新功能特性无法快速发布上线。1995 年，Amazon 网站的技术架构，如下图所示<sup class="footnote-ref"><a href="#fn3" id="fnref3:1">[3:1]</a></sup>：</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2023/11/amazon-architecture-evolution/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://nullwy.me/2023/10/reliability-engineering/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://static.nullwy.me/avatar.png">
      <meta itemprop="name" content="nullwy">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="nullwy's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/10/reliability-engineering/" class="post-title-link" itemprop="url">可靠性工程概述</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-10-19 12:43:00" itemprop="dateCreated datePublished" datetime="2023-10-19T12:43:00+08:00">2023-10-19</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%9E%B6%E6%9E%84/" itemprop="url" rel="index"><span itemprop="name">架构</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    <i class="far fa-comment"></i>
    <a title="disqus" href="/2023/10/reliability-engineering/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2023/10/reliability-engineering/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>17k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>16 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>为了应对负载的增长，目前大型网站普遍都采用分布式架构。相对于采用单体架构的系统，分布式系统中有大量的服务器及设备，各模块之间存在错综复杂的依赖关系，存在更多的不确定性。整个系统的故障率会随设备的增加而呈指数级增加，单一节点问题可能会被无限放大，日常运行过程中一定会伴随故障发生。所以，可靠性开始成为大型网站关注的最重要的质量属性之一，并因此发展出了站点可靠性工程（<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Site_reliability_engineering">Site reliability engineering</a>，SRE）。站点可靠性工程，是从可靠性工程发展而来的，从可靠性工程中借鉴了概念和成果。本文溯本求源，内容主要是总结概括，可靠性工程的历史演进和核心概念，软件可靠性工程的核心概念，以及可靠性设计的方法。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2023/10/reliability-engineering/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://nullwy.me/2023/07/io-multiplexing-network-server/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://static.nullwy.me/avatar.png">
      <meta itemprop="name" content="nullwy">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="nullwy's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/07/io-multiplexing-network-server/" class="post-title-link" itemprop="url">I/O 多路复用与网络服务器并发策略</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-07-26 00:44:00" itemprop="dateCreated datePublished" datetime="2023-07-26T00:44:00+08:00">2023-07-26</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%9E%B6%E6%9E%84/" itemprop="url" rel="index"><span itemprop="name">架构</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    <i class="far fa-comment"></i>
    <a title="disqus" href="/2023/07/io-multiplexing-network-server/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2023/07/io-multiplexing-network-server/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>19k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>17 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>目前主流的网络服务器，网络 I/O 相关的底层最核心的技术都是 I/O 多路复用（I/O Multiplexing），比如 Apache HTTP Server、Nginx、Redis 等。本文尝试解释各种 I/O 模型，包括解释什么是 I/O 多路复用，同时也总结 I/O 多路复用底层的系统调用 select、poll、kqueue 和 epoll 的演进和区别，并编写了使用这些函数的示例代码。另外，本文还总结了各种基于 I/O 多路复用实现的网络服务器的并发策略的三种模式，包括对 Apache HTTP Server、Nginx 和 Redis 等网络服务器的并发策略的具体案例的解析。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2023/07/io-multiplexing-network-server/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://nullwy.me/2023/07/innodb-locking/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://static.nullwy.me/avatar.png">
      <meta itemprop="name" content="nullwy">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="nullwy's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/07/innodb-locking/" class="post-title-link" itemprop="url">InnoDB 的并发控制：锁与 MVCC</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-07-10 21:20:00" itemprop="dateCreated datePublished" datetime="2023-07-10T21:20:00+08:00">2023-07-10</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/MySQL/" itemprop="url" rel="index"><span itemprop="name">MySQL</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    <i class="far fa-comment"></i>
    <a title="disqus" href="/2023/07/innodb-locking/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2023/07/innodb-locking/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>27k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>24 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>目前主流数据库事务的并发控制实现，如 MySQL InnoDB、PostgreSQL、Oracle，都使用两阶段封锁 <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Two-phase_locking">2PL</a> 与 <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Multiversion_concurrency_control">MVCC</a> 技术，但具体实现细节上存在差异。InnoDB 是在以封锁技术为主体的情况下，用 MVCC 技术辅助实现读-写、写-读操作的并发。PostgreSQL 的并发控制技术是以 MVCC 技术为主，封锁技术为辅。本文主要关注 InnoDB 事务的并发控制实现。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2023/07/innodb-locking/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://nullwy.me/2020/05/kong-gateway/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://static.nullwy.me/avatar.png">
      <meta itemprop="name" content="nullwy">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="nullwy's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/kong-gateway/" class="post-title-link" itemprop="url">微服务 API 网关 Kong 实践</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-05-30 15:22:41" itemprop="dateCreated datePublished" datetime="2020-05-30T15:22:41+08:00">2020-05-30</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%9E%B6%E6%9E%84/" itemprop="url" rel="index"><span itemprop="name">架构</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    <i class="far fa-comment"></i>
    <a title="disqus" href="/2020/05/kong-gateway/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2020/05/kong-gateway/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>12k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>11 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Kong-简介">Kong 简介</h1>
<p>Kong 是云原生、高效、可扩展、分布式的微服务抽象层，被称为 API 网关，或者 API 中间件。Kong 在 2015 年 4 月由 Mashape 公司开源，基于 OpenResty 和 Apache Cassandra/PostgreSQL 构建，提供易于使用的 RESTful API 来操作和配置 API 系统<sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup><sup class="footnote-ref"><a href="#fn2" id="fnref2">[2]</a></sup>。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2020/05/kong-gateway/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://nullwy.me/2019/06/mysql-5.7-json/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://static.nullwy.me/avatar.png">
      <meta itemprop="name" content="nullwy">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="nullwy's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/06/mysql-5.7-json/" class="post-title-link" itemprop="url">MySQL 5.7 的 JSON 类型</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-06-25 03:18:31" itemprop="dateCreated datePublished" datetime="2019-06-25T03:18:31+08:00">2019-06-25</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/MySQL/" itemprop="url" rel="index"><span itemprop="name">MySQL</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    <i class="far fa-comment"></i>
    <a title="disqus" href="/2019/06/mysql-5.7-json/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/06/mysql-5.7-json/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>30k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>27 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>2015 年 8 月，MySQL 5.7.8 开始提供对 JSON 的原生支持<sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup><sup class="footnote-ref"><a href="#fn2" id="fnref2">[2]</a></sup>。MySQL 对 JSON 的支持可以说是千呼万唤始出来。2009 年开始 NoSQL 逐渐流行起来，相继出现了键值对数据库、文档数据库、列族数据库、图数据库等各类 NoSQL，解决经典关系型数据库无法解决的痛点。其中，对灵活存储半结构化数据的需求，使得类似 MongoDB 这类文档数据库涌现出来。各大主流关系型数据库也在响应趋势，开始支持半结构化数据。早在 2012 年，PostgreSQL 9.2 就已经添加了 JSON 数据类型<sup class="footnote-ref"><a href="#fn3" id="fnref3">[3]</a></sup>。Oracle 也在 2014 年 7 月发布 12c Release 1 后开始支持 JSON<sup class="footnote-ref"><a href="#fn4" id="fnref4">[4]</a></sup><sup class="footnote-ref"><a href="#fn5" id="fnref5">[5]</a></sup>。Facebook 在 MySQL 5.7 没发布之前，对 5.6 版本的 MySQL 添加了存储 JSON 功能，这个特性被 Facebook 命名为 DocStore (Document Database for MySQL at Facebook)<sup class="footnote-ref"><a href="#fn6" id="fnref6">[6]</a></sup><sup class="footnote-ref"><a href="#fn7" id="fnref7">[7]</a></sup>。另外，SQL 标准组织行动也很快，在 2014 年 3 月已经完成了 SQL/JSON 标准草案（SQL/JSON Proposals）<sup class="footnote-ref"><a href="#fn8" id="fnref8">[8]</a></sup><sup class="footnote-ref"><a href="#fn9" id="fnref9">[9]</a></sup><sup class="footnote-ref"><a href="#fn10" id="fnref10">[10]</a></sup>。完整的草案在 2016 年 12 月正式被采纳为标准，即 SQL:2016。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2019/06/mysql-5.7-json/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://nullwy.me/2019/01/elastic-stack/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://static.nullwy.me/avatar.png">
      <meta itemprop="name" content="nullwy">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="nullwy's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/01/elastic-stack/" class="post-title-link" itemprop="url">Elastic Stack 日志分析平台搭建笔记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-01-14 14:58:20" itemprop="dateCreated datePublished" datetime="2019-01-14T14:58:20+08:00">2019-01-14</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%9E%B6%E6%9E%84/" itemprop="url" rel="index"><span itemprop="name">架构</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    <i class="far fa-comment"></i>
    <a title="disqus" href="/2019/01/elastic-stack/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/01/elastic-stack/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>21k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>19 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Elastic Stack（旧称 ELK Stack）是最受欢迎的开源日志平台 [ <a target="_blank" rel="noopener" href="https://www.elastic.co/cn/solutions/logging">ref</a> ]。Elastic Stack 由 Elasticsearch、Logstash、Kibana 和 Beats 四个组件组成：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.elastic.co/cn/products/beats">Beats</a>，是轻量型采集器的平台，从边缘机器向 Logstash 和 Elasticsearch 发送数据。</li>
<li><a target="_blank" rel="noopener" href="https://www.elastic.co/cn/products/logstash">Logstash</a>，集中、转换和存储数据，是动态数据收集管道，拥有可扩展的插件生态系统，能够与 Elasticsearch 产生强大的协同作用。</li>
<li><a target="_blank" rel="noopener" href="https://www.elastic.co/cn/products/elasticsearch">Elasticsearch</a>，搜索、分析和存储您的数据，是基于 JSON 的分布式搜索和分析引擎，专为实现水平扩展、高可靠性和管理便捷性而设计。</li>
<li><a target="_blank" rel="noopener" href="https://www.elastic.co/cn/products/kibana">Kibana</a>，实现数据可视化，导览 Elastic Stack。能够以图表的形式呈现数据，并且具有可扩展的用户界面，供您全方位配置和管理 Elastic Stack。</li>
</ul>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2019/01/elastic-stack/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://nullwy.me/2018/10/java-agent/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://static.nullwy.me/avatar.png">
      <meta itemprop="name" content="nullwy">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="nullwy's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/10/java-agent/" class="post-title-link" itemprop="url">Java Agent 学习笔记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-10-04 23:26:20" itemprop="dateCreated datePublished" datetime="2018-10-04T23:26:20+08:00">2018-10-04</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    <i class="far fa-comment"></i>
    <a title="disqus" href="/2018/10/java-agent/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2018/10/java-agent/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>13k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>12 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Java 从 1.5 开始提供了 <code>java.lang.instrument</code>（<a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/8/docs/technotes/guides/instrumentation/">doc</a>）包，该包为检测（<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Instrumentation_%28computer_programming%29">instrument</a>） Java 程序提供 API，比如用于监控、收集性能信息、诊断问题。通过 <code>java.lang.instrument</code> 实现工具被称为 Java Agent。Java Agent 可以修改类文件的字节码，通常是，在字节码方法插入额外的字节码来完成检测。关于如何使用 <code>java.lang.instrument</code> 包，可以参考 javadoc 的包描述（<a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/8/docs/api/java/lang/instrument/package-summary.html">en</a>, <a target="_blank" rel="noopener" href="http://www.cjsdn.net/doc/jdk60/java/lang/instrument/package-summary.html">zh</a>）。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2018/10/java-agent/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://nullwy.me/2018/06/mysql-binlog/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://static.nullwy.me/avatar.png">
      <meta itemprop="name" content="nullwy">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="nullwy's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/06/mysql-binlog/" class="post-title-link" itemprop="url">MySQL binlog：格式、增量恢复、闪回、Java 解析</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-06-18 15:09:51" itemprop="dateCreated datePublished" datetime="2018-06-18T15:09:51+08:00">2018-06-18</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/MySQL/" itemprop="url" rel="index"><span itemprop="name">MySQL</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    <i class="far fa-comment"></i>
    <a title="disqus" href="/2018/06/mysql-binlog/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2018/06/mysql-binlog/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>12k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>11 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>MySQL 的 <a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/binary-log.html">binlog</a> 日志文件，记录了数据库表的全部修改操作。本文简单整理 MySQL binlog 相关知识，以及如何使用 binlog 恢复或闪回数据库数据。</p>
<h1 id="STATEMENT-格式的-binlog">STATEMENT 格式的 binlog</h1>
<p>要想开启 binlog，需要在启动 MySQL 时传入 --<a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/replication-options-binary-log.html#option_mysqld_log-bin">log-bin</a> 参数。或者也可以在 MySQL 配置文件 <code>/etc/my.cnf</code>，设置 <code>log_bin</code> 开启 binlog。MySQL 5.7 开始，开启 binlog 后，<code>--server-id</code> 参数也必须指定，否则 MySQL 服务器会启动失败。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2018/06/mysql-binlog/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://nullwy.me/2018/01/stack-frame-calling-convention/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://static.nullwy.me/avatar.png">
      <meta itemprop="name" content="nullwy">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="nullwy's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/01/stack-frame-calling-convention/" class="post-title-link" itemprop="url">栈帧与调用惯例</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-01-29 17:09:51" itemprop="dateCreated datePublished" datetime="2018-01-29T17:09:51+08:00">2018-01-29</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F/" itemprop="url" rel="index"><span itemprop="name">计算机系统</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    <i class="far fa-comment"></i>
    <a title="disqus" href="/2018/01/stack-frame-calling-convention/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2018/01/stack-frame-calling-convention/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>8k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>7 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="栈与栈帧">栈与栈帧</h1>
<p>要想知道函数是怎么被调用的，需要了解栈帧和调用惯例相关知识。<a target="_blank" rel="noopener" href="https://book.douban.com/subject/3652388/">俞甲子2009</a> 的“<strong>第10章 内存: 栈与堆</strong>”对相关概念有很好的介绍。本文是对相关知识的学习笔记。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2018/01/stack-frame-calling-convention/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://nullwy.me/2018/01/java-ffi/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://static.nullwy.me/avatar.png">
      <meta itemprop="name" content="nullwy">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="nullwy's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/01/java-ffi/" class="post-title-link" itemprop="url">Java 外部函数接口：JNI, JNA, JNR</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-01-24 16:09:51" itemprop="dateCreated datePublished" datetime="2018-01-24T16:09:51+08:00">2018-01-24</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    <i class="far fa-comment"></i>
    <a title="disqus" href="/2018/01/java-ffi/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2018/01/java-ffi/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>10k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>9 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="遇到的问题">遇到的问题</h1>
<p>前段时间开发的时候，遇到一个问题，就是如何用 Java 实现 <code>chdir</code>？网上搜索一番，发现了 <code>JNR-POSIX</code> 项目 [ <a target="_blank" rel="noopener" href="https://stackoverflow.com/q/840190">stackoverflow</a> ]。俗话说，好记性不如烂笔头。现在将涉及到的相关知识点总结成笔记。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2018/01/java-ffi/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://nullwy.me/2017/11/zookeeper-note/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://static.nullwy.me/avatar.png">
      <meta itemprop="name" content="nullwy">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="nullwy's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/11/zookeeper-note/" class="post-title-link" itemprop="url">ZooKeeper 学习笔记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-11-23 15:52:51" itemprop="dateCreated datePublished" datetime="2017-11-23T15:52:51+08:00">2017-11-23</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%9E%B6%E6%9E%84/" itemprop="url" rel="index"><span itemprop="name">架构</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    <i class="far fa-comment"></i>
    <a title="disqus" href="/2017/11/zookeeper-note/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/11/zookeeper-note/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>13k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>12 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="ZooKeeper-介绍">ZooKeeper 介绍</h1>
<p>ZooKeeper（<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Apache_ZooKeeper">wiki</a>，<a target="_blank" rel="noopener" href="http://zookeeper.apache.org/">home</a>，<a target="_blank" rel="noopener" href="https://github.com/apache/zookeeper">github</a>） 是用于分布式应用的开源的分布式协调服务。通过暴露简单的原语，分布式应用能在之上构建更高层的服务，如同步、配置管理和组成员管理等。在设计上易于编程开发，并且数据模型使用了熟知的文件系统目录树结构 [ <a target="_blank" rel="noopener" href="http://zookeeper.apache.org/doc/current/zookeeperOver.html">doc</a> ]。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2017/11/zookeeper-note/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://nullwy.me/2017/05/java-method-parameter/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://static.nullwy.me/avatar.png">
      <meta itemprop="name" content="nullwy">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="nullwy's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/05/java-method-parameter/" class="post-title-link" itemprop="url">Java 运行时获取方法参数名</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-05-02 15:09:51" itemprop="dateCreated datePublished" datetime="2017-05-02T15:09:51+08:00">2017-05-02</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    <i class="far fa-comment"></i>
    <a title="disqus" href="/2017/05/java-method-parameter/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/05/java-method-parameter/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>11k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>10 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>本文整理 Java 运行时获取方法参数名的两种方法，Java 8 的最新的方法和 Java 8 之前的方法。</p>
<h1 id="Java-8-的新特性">Java 8 的新特性</h1>
<p>翻阅 Java 8 的<a target="_blank" rel="noopener" href="http://openjdk.java.net/projects/jdk8/features">新特性</a>，可以看到有这么一条“<a target="_blank" rel="noopener" href="http://openjdk.java.net/jeps/118">JEP 118</a>: Access to Parameter Names at Runtime”。这个特性就是为了能运行时获取参数名新加的。这个 <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/JDK_Enhancement_Proposal">JEP</a> 只是功能增强的提案，并没有最终实现的 JDK 相关的 API 的介绍。查看“<a target="_blank" rel="noopener" href="http://docs.oracle.com/javase/8/docs/technotes/guides/reflection/enhancements.html">Enhancements to the Reflection API</a>” 会看到如下介绍：</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2017/05/java-method-parameter/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://nullwy.me/2017/04/javac-api/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://static.nullwy.me/avatar.png">
      <meta itemprop="name" content="nullwy">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="nullwy's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/04/javac-api/" class="post-title-link" itemprop="url">Java 编译器 javac 及 Lombok 实现原理解析</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-04-20 11:53:53" itemprop="dateCreated datePublished" datetime="2017-04-20T11:53:53+08:00">2017-04-20</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    <i class="far fa-comment"></i>
    <a title="disqus" href="/2017/04/javac-api/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/04/javac-api/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>17k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>16 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><code>javac</code> 是 Java 代码的编译器<sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup><sup class="footnote-ref"><a href="#fn2" id="fnref2">[2]</a></sup>，初学 Java 的时候就应该接触过。本文整理一些 <code>javac</code> 相关的高级用法。Lombok 库，大家平常一直在使用，但可能并不知道实现原理解析，其实 Lombok 实现上依赖的是 Java 编译器的注解处理 API（<a target="_blank" rel="noopener" href="https://www.jcp.org/en/jsr/detail?id=269">JSR-296</a>）<sup class="footnote-ref"><a href="#fn3" id="fnref3">[3]</a></sup>，本文同时尝试解析 Lombok 的实现原理。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2017/04/javac-api/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="nullwy"
      src="https://static.nullwy.me/avatar.png">
  <p class="site-author-name" itemprop="name">nullwy</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">30</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">63</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/yulewei" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;yulewei" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:yulewei@gmail.com" title="E-Mail → mailto:yulewei@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://segmentfault.com/u/nullwy" title="SegmentFault → https:&#x2F;&#x2F;segmentfault.com&#x2F;u&#x2F;nullwy" rel="noopener" target="_blank"><i class="fa fa-globe fa-fw"></i>SegmentFault</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.douban.com/people/yulewei/" title="豆瓣 → https:&#x2F;&#x2F;www.douban.com&#x2F;people&#x2F;yulewei&#x2F;" rel="noopener" target="_blank"><i class="fa fa-globe fa-fw"></i>豆瓣</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://juejin.cn/user/3670612013220988" title="掘金 → https:&#x2F;&#x2F;juejin.cn&#x2F;user&#x2F;3670612013220988" rel="noopener" target="_blank"><i class="fa fa-globe fa-fw"></i>掘金</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        
  <div class="beian">
    备案号：<a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">浙ICP备17005717号 </a>
  </div>

<div class="copyright">
  
  &copy; 2016 – 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">nullwy</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">386k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">5:51</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> 强力驱动
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      总访客量
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    总访问量
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://yulewei.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>

</body>
</html>
